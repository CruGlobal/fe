<% if @presenter.active_page %>
    <% page_dom = @presenter.active_page_link.dom_id
       next_js = load_page_js(@presenter.next_page) -%>

    <div id="<%= page_dom %>" class="answer-page" style="<% if show_first.nil? -%>display: none;<% end -%>">  <!-- this id is parsed by fe.public.js -->

      <div class="page">
        <h4 id='page-name'><%= @presenter.active_page.label %></h4>

        <% if @elements.length > 0 -%>
            <%= form_tag @presenter.active_page_link.save_path, :id => "#{page_dom}-form", :onsubmit => "$.fe.pageHandler.savePage($('#sp_application_55716-page_331')); return false;", :multipart => true do -%>
                <ul class="questions" id="questions_list">
                  <% @elements.each do |element| %>
                      <li class="<%= element.class.to_s.downcase %>" id="element_<%= element.id %>">
                        <%= render 'fe/answer_pages/element', :element => element %>
                      </li>
                  <% end %>
                </ul>

                <% if next_js.empty? -%>
                    <div id="submit_message" class="validation-advice" style="display: none;"></div>
                    <div>
                      <button type="submit" style="background-color: #f9b625; border: 2px solid #f8ae0c; color: white !important;" class="button cru-gold no-left-margin" onclick="page_handler.completeAll(); return false;" id="submit_button">Submit</button>
                      <button type="button" class="button">Save Now</button>
                    </div>
                <% else -%>
                    <div class="savestatus">
                      Last Saved: <span class="last-saved"><%= l(@answer_sheet.updated_at, :format => :datetime) %></span><%= spinner(page_dom) %>
                    </div>
                    <div>
                      <button type="button" class="button no-left-margin">Save Now</button>
                      <button type="button" class="button cru-gold" onclick="<%= next_js %>">Next >></button>
                    </div>
                <% end -%>

            <% end -%>

        <% else -%>

            <div style="background: #ffc;">
              <p>There are no questions on this page.</p>
            </div>

        <% end -%>

      </div>

    </div>
    <% if session[:attempted_submit] %>
        <script type="text/javascript" charset="utf-8">
            $(function() {
                $.fe.pageHandler.validatePage('<%= page_dom %>')
            });
        </script>
    <% end %>
<% end %>